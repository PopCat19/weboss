<!DOCTYPE html>
<html lang="en" class="bg-black-100">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home</title>
    <link rel="icon" href="img/favicon.png">
    <!-- <link rel="stylesheet" href="css/picnic.min.css"> -->
    <!-- <link rel="stylesheet" href="css/dist/main.css"> -->
    <!-- <link rel="stylesheet" href="css/font.css"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&display=swap" rel="stylesheet">
    <link href="./output.css" rel="stylesheet">
</head>

<body class="bg-baseCrimson-100">
    <!-- Game Area -->
    <div class="game-area" id="game-area" hidden></div>
    <div class="pause-menu" id="pause-menu" hidden>
        <div class="paused-title">Paused</div>
        <div class="button-list">
            <div class="pausebutton continue" id="pausebtn-continue">
                <div class="inner">Continue</div>
            </div>
            <div class="pausebutton retry" id="pausebtn-retry">
                <div class="inner">Retry</div>
            </div>
            <div class="pausebutton quit" id="pausebtn-quit">
                <div class="inner">Quit</div>
            </div>
        </div>
    </div>
    <!-- Nav Bar -->
    <nav id="main-nav" class="bg-secondaryCrimson-12 w-full flex items-center justify-between px-4 py-2">
        <!-- Left Group: Logo, Navigation Links -->
        <div class="flex items-center space-x-4">
            <a href="index.html" class="text-24 font-bold text-primaryCrimson-100 mr-2">weboss!</a>
            <a href="new.html" class="bg-secondaryCrimson-12 hover:text-white-100 text-secondaryCrimson-100 font-bold py-2 px-4 rounded-16">New</a>
            <a href="hot.html" class="bg-secondaryCrimson-12 hover:text-white-100 text-secondaryCrimson-100 font-bold py-2 px-4 rounded-16">Popular</a>
            <a href="browse.html" class="bg-secondaryCrimson-12 hover:text-white-100 text-secondaryCrimson-100 font-bold py-2 px-4 rounded-16">Browse</a>
        </div>

        <!-- Center Group: Search Box -->
        <div class="flex items-center">
            <form action="search.html" class="flex items-center bg-secondaryCrimson-12">
                <input type="text" name="q" placeholder="Search" class="w-48 h-10 px-3 text-14 text-secondaryCrimson-32 rounded-l-16 border" />
                <button type="submit" class="h-10 bg-baseCrimson-64 hover:bg-secondaryCrimson-32 text-secondaryCrimson-100 font-bold px-3 rounded-r-16 border border-secondaryCrimson-24 border-l-0 flex items-center justify-center">
                    <img src="/img/search.svg" alt="Search" class="w-5 h-5 text-secondaryCrimson-100" />
                </button>
            </form>
        </div>

        <!-- Right Group: Action Links -->
        <div class="flex items-center space-x-4">
            <a href="liked.html" class="bg-secondaryCrimson-12 hover:text-white-100 text-secondaryCrimson-100 font-bold py-2 px-4 rounded-16">Favorites</a>
            <a href="faq.html" class="bg-secondaryCrimson-12 hover:text-white-100 text-secondaryCrimson-100 font-bold py-2 px-4 rounded-16">FAQ</a>
            <a href="settings.html" class="bg-secondaryCrimson-12 hover:text-white-100 text-secondaryCrimson-100 font-bold py-2 px-4 rounded-16">Settings</a>
        </div>
    </nav>
    <!-- Main Page -->
    <main class="main-page flex flex-col w-full my-4 px-4" id="main-page">
        <div class="site-notice-container">
            <div class="site-notice bg-secondaryCrimson-32 text-baseCrimson-100 p-4 font-medium rounded-16 text-16">
                Note: This site is still in-development... Expect bugs --
                Forked from
                <a href="https://github.com/111116/webosu" class="text-primaryCrimson-80 hover:text-primaryCrimson-100 underline">
                    github.com/111116/webosu
                </a>
                with scripts from
                <a href="https://github.com/BlaNKtext/webosu" class="text-primaryCrimson-80 hover:text-primaryCrimson-100 underline">
                    github.com/BlaNKtext/webosu
                </a>
            </div>
        </div>
        <!-- <div class="flex w-full my-8 px-2">
            <div class="h-1 w-full rounded-16 bg-secondaryCrimson-12"></div>
        </div> -->
    </main>
    <!-- Index Areas -->
    <div class="space-y-16 mx-4">
        <div class="index-area bg-baseCrimson-100 rounded-16">
            <div class="flex justify-between items-end">
                <h2 class="text-24 font-semiBold text-primaryCrimson-100">Popular beatmaps</h2>
                <a href="hot.html" class="text-accentCrimson-100 hover:underline text-16">See more Popular Beatmaps</a>
            </div>
            <div class="h-1 w-full rounded-16 bg-secondaryCrimson-12 mt-2 mb-4"></div>
            <div class="beatmap-list" id="beatmap-list-hot"></div>
        </div>

        <div class="index-area bg-baseCrimson-100 rounded-16">
            <div class="flex justify-between items-end">
                <h2 class="text-24 font-semiBold text-primaryCrimson-100">Previously Played</h2>
                <a href="history.html" class="text-accentCrimson-100 hover:underline align-text-bottom text-16">See your play history</a>
            </div>
            <div class="h-1 w-full rounded-16 bg-secondaryCrimson-12 mt-2 mb-4"></div>
            <div class="beatmap-list" id="beatmap-list-history"></div>
        </div>

        <div class="index-area bg-baseCrimson-100 rounded-16">
            <div class="flex justify-between items-end">
                <h2 class="text-24 font-semiBold text-primaryCrimson-100">Favorited Beatmaps</h2>
                <a href="liked.html" class="text-accentCrimson-100 hover:underline align-text-bottom text-16">See all favorited Beatmaps</a>
            </div>
            <div class="h-1 w-full rounded-16 bg-secondaryCrimson-12 mt-2 mb-4"></div>
            <div class="beatmap-list" id="beatmap-list-liked"></div>
        </div>

        <div class="index-area bg-baseCrimson-100 rounded-16">
            <div class="flex justify-between items-end">
                <h2 class="text-24 font-semiBold text-primaryCrimson-100">Latest Beatmaps</h2>
                <a href="new.html" class="text-accentCrimson-100 hover:underline align-text-bottom text-16">See all latest Beatmaps</a>
            </div>
            <div class="h-1 w-full rounded-16 bg-secondaryCrimson-12 mt-2 mb-4"></div>
            <div class="beatmap-list" id="beatmap-list-new"></div>
        </div>

        <div class="index-area bg-baseCrimson-100 rounded-16">
            <div class="flex justify-between items-end">
                <h2 class="text-24 font-semiBold text-primaryCrimson-100">Random Beatmaps</h2>
                <a onclick="genRandomList()" class="text-accentCrimson-100 hover:underline align-text-bottom cursor-pointer text-16">
                    Randomize
                </a>
            </div>
            <div class="h-1 w-full rounded-16 bg-secondaryCrimson-12 mt-2 mb-4"></div>
            <div class="beatmap-list" id="beatmap-list-random"></div>
        </div>
    </div>
    <!-- Loader Progress -->
    <div class="statuslines" id="statuslines">
        <div class="progress" id="script-progress">
            Scripts
            <div class="lds-dual-ring"></div>
        </div>
        <div class="progress" id="skin-progress">
            Skin
            <div class="lds-dual-ring"></div>
        </div>
        <div class="progress" id="sound-progress">
            Hitsounds
            <div class="lds-dual-ring"></div>
        </div>
    </div>
    </div>
    <!-- Footer -->
    <div class="footer">
        <div class="footer-infos">
            <span class="footer-info">Beatmap Mirror <a href="https://catboy.best/">Mino</a></span>
            <span class="footer-info">Source code: <a href="https://github.com/PopCat19/weboss">Github</a></span>
        </div>
    </div>
    </div>
    <script src="js/launchgame.js"></script>
    <script src="js/downloader.js"></script>
    <script src="js/addbeatmaplist.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/jsloader.js"></script>
    <script src="js/lib/localforage.min.js"></script>
    <script>
        // Recently played
        if (window.localforage) {
            let listHistory = document.getElementById("beatmap-list-history");
            localforage.getItem("playhistory1000", function(err, item) {
                if (err) {
                    listHistory.innerText = "Failed to load your recent plays...";
                    return;
                }
                if (item && item.length) {
                    item = item.reverse();
                    let sid = [];
                    for (let i = 0; i < item.length; i++) {
                        if (item[i].sid) sid.push(item[i].sid);
                    }
                    sid = [...new Set(sid)]; // uniq
                    sid.length = Math.min(sid.length, 6)
                    addBeatmapSids(sid, listHistory)
                } else {
                    listHistory.innerText = "You haven't played any Beatmaps yet!";
                }
            })
        }

        // Get new beatmaps
        console.log("Fetching new beatmaps...");
        addBeatmapList("https://catboy.best/api/v2/search?q=&limit=6&offset=0&status=4&mode=0",
            document.getElementById("beatmap-list-new"),
            function(t) {
                console.log("Filtering beatmap:", t);
                return (t.modes & 1) != 0;
            }, 4);
        console.log("New beatmaps fetched and filtered.");

        // Get random beatmaps
        function genRandomList() {
            console.log("Generating random beatmap list...");
            // Wipe Random List
            let list = document.getElementById("beatmap-list-random");
            console.log("Clearing random list element:", list);
            list.innerHTML = ''
            console.log("Random list element cleared.");

            // Re-fill Random List
            let randstart = Math.floor(Math.random() * 10000);
            console.log("Generating random offset:", randstart);
            addBeatmapList("https://catboy.best/api/v2/search?q=&limit=6&offset=" + randstart + "&status=4&status=1&mode=0", list,
                function(t) {
                    console.log("Filtering random beatmap:", t);
                    while (list.firstChild) {
                        console.log("Removing child element from random list:", list.firstChild);
                        list.removeChild(list.firstChild);
                    }
                    return (t.modes & 1) != 0;
                }, 4);
            console.log("Random beatmap list generated and filtered.");
        }
        genRandomList();

        // Get hot beatmaps
        addBeatmapList("https://catboy.best/api/v2/search?q=&limit=6&offset=0&status=1&status=4&mode=0", document.getElementById(
            "beatmap-list-hot"));

        // Favorite beatmaps
        if (window.localforage) {
            window.localforage.getItem("likedsidset", function(err, val) {
                if (err) {
                    document.getElementById("beatmap-list-liked").innerText =
                        "Failed to load favorites list.";
                    return;
                }
                if (val && val.size) {
                    let listLike = document.getElementById("beatmap-list-liked");
                    let list = Array.from(val);
                    list.length = Math.min(list.length, 6)
                    addBeatmapSids(list, listLike);
                } else {
                    document.getElementById("beatmap-list-liked").innerText =
                        "You haven't favorited any Beatmaps yet Click on the heart in the lower right corner of the Beatmap to save it.";
                }
            });
        } else {
            alert("Oh no, localforage isn't supported on this browser")
        }
    </script>
</body>

</html>